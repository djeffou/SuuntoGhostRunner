function findLinearFunction(f,e){var d=(e.y-f.y)/(e.x-f.x);var c=f.y-d*f.x;return{a:d,b:c}}function distanceFromAPointToALine(b,a){return Math.abs(a.a*b.x-b.y+a.b)/Math.sqrt(a.a*a.a+1)}function displayError(a){document.getElementById("error").innerText=a;document.getElementById("error").style.display="initial"}function displaySuccess(){document.getElementById("success").style.display="initial"}function go(){init();var c=loadInput();var e=transformInput(c);var a=149;if(document.getElementById("ambit1").checked){a=59}var d=reduceNumberOfNodes(e,a);displayMinimizedArray(d);var b=getSuuntoCode(d);displaySuuntoCode(b);displayDetails(e,d);displaySuccess()}function init(){document.getElementById("error").style.display="none";document.getElementById("success").style.display="none";document.getElementById("out").value="";document.getElementById("code").value="";document.getElementById("distance").innerHTML="-";document.getElementById("from").innerHTML="-";document.getElementById("to").innerHTML="-"}function loadInput(){var a=document.getElementById("input").value.trim();if(a==""){displayError('"Input" should not be empty');return}return a}function transformInput(l){var m=l.split("\n");var d=[];var n=0;var c=0;for(var g=0;g<m.length;g++){var k=m[g].split("\t");if(k.length!=3){displayError("Wrong number of columns at line "+(g+1));return}var j=k[0];var a=k[2];if(n==a){d.pop()}n=a;var f=moment(j,"YYYY-MM-DD HH:mm:ss");if(isNaN(f)){displayError("Wrong date format at line "+(g+1));return false}var h=f.unix();if(g==0){c=h}var e=h-c;d.push({x:e,y:a})}return d}function reduceNumberOfNodes(d,a){var c=1;var b=d[d.length-1];while(d.length>a){d=RDPalgorithm(d,c);d.push(b);c+=0.01}return d}function RDPalgorithm(g,j){var f=0;var b=0;var a=[];var e=findLinearFunction(g[0],g[g.length-1]);for(var c=1;c<g.length-1;c++){var h=distanceFromAPointToALine(g[c],e);if(h>f){b=c;f=h}}if(f>j){a=a.concat(RDPalgorithm(g.slice(0,b+1),j));a=a.concat(RDPalgorithm(g.slice(b,g.length),j))}else{a.push(g[0])}return a}function displayMinimizedArray(b){var c="";for(var a in b){if(b.hasOwnProperty(a)){c+=b[a].x+"\t"+b[a].y+"\n"}}document.getElementById("out").value=c}function getSuuntoCode(c){var a="";for(var b=1;b<c.length;b++){if(b==1){a+="if(SUUNTO_DURATION<="+c[1].x+"){"}else{if(b==c.length-1){a+="else {"}else{a+="else if(SUUNTO_DURATION <= "+c[b].x+"){"}}a+=getCoeffString(c[b].y,c[b].x)+";}"}return a+="RESULT=SUUNTO_DURATION*c-SUUNTO_DISTANCE;"}function getCoeffString(b,a){return"c="+(Math.round(b/a*10000)/10000)}function displaySuuntoCode(a){document.getElementById("code").value=a}function displayDetails(b,a){document.getElementById("distance").innerHTML=a[a.length-1].y;document.getElementById("from").innerHTML=b.length;document.getElementById("to").innerHTML=a.length};